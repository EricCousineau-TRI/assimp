Author: IOhannes m zm√∂lnig
Description: use system's zlib rather than the one that comes with assimp
Forwarded: not-needed
--- assimp.orig/CMakeLists.txt
+++ assimp/CMakeLists.txt
@@ -50,6 +50,23 @@
 ENDIF ( ENABLE_BOOST_WORKAROUND )
 
 
+SET ( USE_BUILTIN_ZLIB ON CACHE BOOL
+	"If the built-in zlib is used or the one found on the system."
+)
+IF ( NOT USE_BUILTIN_ZLIB )
+  INCLUDE(${CMAKE_ROOT}/Modules/FindZLIB.cmake)
+  IF ( NOT ZLIB_FOUND )
+    MESSAGE( STATUS
+            "Could not find system's zlib. "
+            "Falling back to built-in zlib."
+           )
+  ELSE ( NOT ZLIB_FOUND )
+    ADD_DEFINITIONS( -DASSIMP_BUILD_NO_OWN_ZLIB )
+  ENDIF ( NOT ZLIB_FOUND )
+ELSE ( NOT USE_BUILTIN_ZLIB )
+  SET (ZLIB_FOUND 0)
+ENDIF ( NOT USE_BUILTIN_ZLIB )
+
 ADD_SUBDIRECTORY( code/ )
 SET ( BUILD_ASSIMP_TOOLS ON CACHE BOOL
 	"If the supplementary tools for Assimp are built in addition to the library."
--- assimp.orig/code/CMakeLists.txt
+++ assimp/code/CMakeLists.txt
@@ -421,8 +421,8 @@
 	../contrib/ConvertUTF/ConvertUTF.h
 	../contrib/ConvertUTF/ConvertUTF.c
 )
-
-SOURCE_GROUP( zlib FILES
+IF ( NOT ZLIB_FOUND )
+SET( ZLIB_FILES
 	../contrib/zlib/adler32.c
 	../contrib/zlib/compress.c
 	../contrib/zlib/crc32.c
@@ -444,6 +444,14 @@
 	../contrib/zlib/zutil.c
 	../contrib/zlib/zutil.h
 )
+ELSE ( NOT ZLIB_FOUND )
+SET( ZLIB_FILES )
+ENDIF ( NOT ZLIB_FOUND )
+
+
+SOURCE_GROUP( zlib FILES
+        ${ZLIB_FILES}
+)
 
 SOURCE_GROUP( unzip FILES
 	../contrib/unzip/crypt.h
@@ -663,27 +671,8 @@
 	../contrib/irrXML/irrTypes.h
 	../contrib/irrXML/irrXML.cpp
 	../contrib/irrXML/irrXML.h
-	../contrib/zlib/adler32.c
-	../contrib/zlib/compress.c
-	../contrib/zlib/crc32.c
-	../contrib/zlib/crc32.h
-	../contrib/zlib/deflate.c
-	../contrib/zlib/deflate.h
-	../contrib/zlib/inffast.c
-	../contrib/zlib/inffast.h
-	../contrib/zlib/inffixed.h
-	../contrib/zlib/inflate.c
-	../contrib/zlib/inflate.h
-	../contrib/zlib/inftrees.c
-	../contrib/zlib/inftrees.h
-	../contrib/zlib/trees.c
-	../contrib/zlib/trees.h
-	../contrib/zlib/zconf.h
-	../contrib/zlib/zconf.in.h
-	../contrib/zlib/zlib.h
-	../contrib/zlib/zutil.c
-	../contrib/zlib/zutil.h
 	../contrib/ConvertUTF/ConvertUTF.c
+  ${ZLIB_FILES}
 	../contrib/unzip/crypt.h
 	../contrib/unzip/ioapi.c
 	../contrib/unzip/ioapi.h
@@ -740,6 +729,8 @@
 	SOVERSION ${LIBRARY_SOVERSION}
 )
 
+TARGET_LINK_LIBRARIES( assimp ${ZLIB_LIBRARY} )
+
 INSTALL( TARGETS assimp DESTINATION ${LIB_INSTALL_DIR} )
 INSTALL( FILES ${PUBLIC_HEADERS} DESTINATION ${INCLUDE_INSTALL_DIR}/assimp )
 INSTALL( FILES ${COMPILER_HEADERS} DESTINATION ${INCLUDE_INSTALL_DIR}/assimp/Compiler )
--- assimp.orig/tools/assimp_cmd/CMakeLists.txt
+++ assimp/tools/assimp_cmd/CMakeLists.txt
@@ -5,7 +5,8 @@
 
 LINK_DIRECTORIES( ${Assimp_BINARY_DIR} ${Assimp_BINARY_DIR}/lib )
 
-ADD_EXECUTABLE( assimp_cmd
+IF ( NOT ZLIB_FOUND )
+SET( ZLIB_FILES
 	../../contrib/zlib/adler32.c
 	../../contrib/zlib/compress.c
 	../../contrib/zlib/crc32.c
@@ -26,6 +27,14 @@
 	../../contrib/zlib/zlib.h
 	../../contrib/zlib/zutil.c
 	../../contrib/zlib/zutil.h
+)
+ELSE ( NOT ZLIB_FOUND )
+ SET( ZLIB_FILES )
+ENDIF ( NOT ZLIB_FOUND )
+
+
+ADD_EXECUTABLE( assimp_cmd
+  ${ZLIB_FILES}
 	assimp_cmd.rc
 	CompareDump.cpp
 	ImageExtractor.cpp
@@ -36,7 +45,7 @@
 	Info.cpp
 )
 
-TARGET_LINK_LIBRARIES( assimp_cmd assimp )
+TARGET_LINK_LIBRARIES( assimp_cmd assimp ${ZLIB_LIBRARY} )
 SET_TARGET_PROPERTIES( assimp_cmd PROPERTIES
 	OUTPUT_NAME assimp
 )
--- assimp.orig/tools/assimp_cmd/Main.h
+++ assimp/tools/assimp_cmd/Main.h
@@ -63,7 +63,12 @@
 #include <../code/StringComparison.h>
 #include <../code/Hash.h>
 
-#include <../contrib/zlib/zlib.h>
+#ifdef ASSIMP_BUILD_NO_OWN_ZLIB
+# include <zlib.h>
+#else
+# include "../contrib/zlib/zlib.h"
+#endif
+
 
 using namespace Assimp;
 
@@ -165,4 +170,4 @@
 	unsigned int num);
 
 
-#endif // !! AICMD_MAIN_INCLUDED
\ No newline at end of file
+#endif // !! AICMD_MAIN_INCLUDED
